<!DOCTYPE html>
<!--?xml version="1.0"?-->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:svg="http://www.w3.org/2000/svg">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Rewrite</title>
<script src="../src/rewrite.js"></script>

<script id="exmpl1" type="text/plain">
/*
    hello world 1
*/

(
    (
        REWRITE
        ((READ greet) (WRITE hello world))
    )

    greet
)
</script>

<script id="exmpl2" type="text/plain">
/*
    hello world 2
*/

(
    (
        REWRITE
        ((VAR <x>) (READ greet <x>) (WRITE hello <x>))
    )

    greet world
)
</script>

<script id="exmpl3" type="text/plain">
/*
    example: `Venus likes milk`
*/

(
    (
        REWRITE
        ((READ <x>) (WRITE Venus))
        ((READ <y>) (WRITE milk ))
    )

    <x> likes <y>
)
</script>

<script id="exmpl4" type="text/plain">
/*
    example: `Pluto likes bones`
*/

(
    (
        REWRITE
        (
            (VAR <a>) (VAR <b>)
            (READ  l <a> <b>)
            (WRITE <a> likes <b>    )
        )
    )
    
    l Pluto bones
)
</script>

<script id="exmpl5" type="text/plain">
/*
    example: `Nikki likes cheese`
*/

(
    (
        REWRITE
        ((READ <x>) (WRITE Nikki ))
        ((READ <y>) (WRITE cheese))
        (
            (VAR <a>) (VAR <b>)
            (READ  l <a> <b>)
            (WRITE <a> likes <b>    )
        )
    )
    
    l <x> <y>
)
</script>

<script id="exmpl-proof" type="text/plain">
/*
    proof checker
*/

(
    (
        REWRITE
        
        // logic rules
        ((VAR a) (VAR b) (READ                                 [/\Intro] a b) (WRITE a /\ b ))
        ((VAR a) (VAR b) (READ                              [/\Elim1] a /\ b) (WRITE a      ))
        ((VAR a) (VAR b) (READ                              [/\Elim2] a /\ b) (WRITE b      ))
        ((VAR a) (VAR b) (READ                                  [\/Intro1] a) (WRITE a \/ b ))
        ((VAR a) (VAR b) (READ                                  [\/Intro2] b) (WRITE a \/ b ))
        ((VAR a) (VAR b) (READ [\/Elim] (a \/ b) (a ... False) (b ... False)) (WRITE False  ))
        ((VAR a) (VAR b) (READ                             [->Intro] a ... b) (WRITE a -> b ))
        ((VAR a) (VAR b) (READ                     [->Elim] (a -> b) (VAR a)) (WRITE b      ))
        ((VAR a) (VAR b) (READ                  [<->Intro] (a -> b) (b -> a)) (WRITE a <-> b))
        ((VAR a) (VAR b) (READ                        [<->Elim1] (a <-> b) a) (WRITE b      ))
        ((VAR a) (VAR b) (READ                        [<->Elim2] (a <-> b) b) (WRITE a      ))
        (        (VAR a) (READ                          [~Intro] a ... False) (WRITE ~ a    ))
        (        (VAR a) (READ                               [~Elim] (~ a) a) (WRITE False  ))
        (        (VAR a) (READ                                     [X] False) (WRITE a      ))
        (        (VAR a) (READ                          [IP] (~ a) ... False) (WRITE a      ))
    
        ((VAR a) (READ [Assume] a) (WRITE a))

        /*
            a proof for De Morgan's law
        */
        
        // (A /\ B) -> ~(~A \/ ~B)
        ((READ f 1       ) (WRITE [Assume] A /\ B                                   ))
        ((READ    f 2    ) (WRITE [Assume] (~ A) \/ (~ B)                           ))
        ((READ      f 3  ) (WRITE [Assume] ~ A                                      ))
        ((READ        f 4) (WRITE [/\Elim1] (f 1)                                   ))
        ((READ        f 5) (WRITE [~Elim] (f 3) (f 4)                               ))
        ((READ      f 6  ) (WRITE [Assume] ~ B                                      ))
        ((READ        f 7) (WRITE [/\Elim2] (f 1)                                   ))
        ((READ        f 8) (WRITE [~Elim] (f 6) (f 7)                               ))
        ((READ      f 9  ) (WRITE [\/Elim] (f 2) ((f 3) ... (f 5)) ((f 6) ... (f 8))))
        ((READ   f 10    ) (WRITE [~Intro] (f 2) ... (f 9)                          ))
        ((READ   f F1    ) (WRITE [->Intro] (f 1) ... (f 10)                        ))
        
        // ~(~A \/ ~B) -> (A /\ B)
        ((READ f 11      ) (WRITE [Assume] ~ ((~ A) /\ (~ B))                       ))
        ((READ   f 12    ) (WRITE [Assume] ~ A                                      ))
        ((READ     f 13  ) (WRITE [\/Intro1] (f 12)                                 ))
        ((READ     f 14  ) (WRITE [~Elim] (f 11) (f 13)                             ))
        ((READ   f 15    ) (WRITE [IP] (f12) .. (f14)                               ))
        ((READ     f 16  ) (WRITE [Assume] ~ B                                      ))
        ((READ       f 17) (WRITE [\/Intro2] (f 16)                                 ))
        ((READ       f 18) (WRITE [~Elim] (f 11) (f 17)                             ))
        ((READ   f 19    ) (WRITE [IP] (f16) .. (f18)                               ))
        ((READ   f 20    ) (WRITE [/\intro] (f 15) (f 19)                           ))
        ((READ   f 21    ) (WRITE [~Intro] (f 2) ... (f 9)                          ))
        ((READ   f F2    ) (WRITE [->Intro] (f 11) ... (f 20)                       ))
        
        // (A /\ B) <-> ~(~A \/ ~B)
        ((READ f QED     ) (WRITE [<->Intro] (f F1) (f F2)                          ))
    )

    // proof listing
    
    (1 f 1) (2 f 2) (3 f 3) (4 f 4) (5 f 5) (6 f 6) (7 f 7) (8 f 8) (9 f 9) (10 f 10) (F1 f F1)
    
    (11 f 11) (12 f 12) (13 f 13) (14 f 14) (15 f 15) (16 f 16) (17 f 17) (18 f 18) (19 f 19) (20 f 20) (F2 f F2)
    
    (QED f QED)
)
</script>

<script id="exmpl-proof2" type="text/plain">
/*
    proof checker
*/

(
    (
        REWRITE
        
        // logic rules
        ((VAR a) (VAR b) (READ                                 [/\Intro] a b) (WRITE a /\ b ))
        ((VAR a) (VAR b) (READ                              [/\Elim1] a /\ b) (WRITE a      ))
        ((VAR a) (VAR b) (READ                              [/\Elim2] a /\ b) (WRITE b      ))
        ((VAR a) (VAR b) (READ                                  [\/Intro1] a) (WRITE a \/ b ))
        ((VAR a) (VAR b) (READ                                  [\/Intro2] b) (WRITE a \/ b ))
        ((VAR a) (VAR b) (READ [\/Elim] (a \/ b) (a ... False) (b ... False)) (WRITE False  ))
        ((VAR a) (VAR b) (READ                             [->Intro] a ... b) (WRITE a -> b ))
        ((VAR a) (VAR b) (READ                     [->Elim] (a -> b) (VAR a)) (WRITE b      ))
        ((VAR a) (VAR b) (READ                  [<->Intro] (a -> b) (b -> a)) (WRITE a <-> b))
        ((VAR a) (VAR b) (READ                        [<->Elim1] (a <-> b) a) (WRITE b      ))
        ((VAR a) (VAR b) (READ                        [<->Elim2] (a <-> b) b) (WRITE a      ))
        (        (VAR a) (READ                          [~Intro] a ... False) (WRITE ~ a    ))
        (        (VAR a) (READ                               [~Elim] (~ a) a) (WRITE False  ))
        (        (VAR a) (READ                                     [X] False) (WRITE a      ))
        (        (VAR a) (READ                          [IP] (~ a) ... False) (WRITE a      ))
            
        // input and output rules
        ((VAR a) (READ [Assume] a) (WRITE a))
        ((VAR a) (VAR b) (READ [Check] a b) (WRITE [Checking] a == b fail))
        ((VAR a) (READ [Checking] a == a fail) (WRITE a))
        
        // proof checking meta-statements
        (
            (VAR <num>) (VAR <formula>)
            (
                READ
                <num> : <formula>
            )
            (
                WRITE
                (
                    'REWRITE
                    ((READ f <num>) (WRITE <formula>))
                )
            )
        )
        
        // rearrange and execute meta-statements
        (
            (VAR <num>) (VAR <x>) (VAR <y>)
            (READ  ('REWRITE ((READ f <num>) <x>)) <y>) 
            (WRITE ((''REWRITE ((READ f <num>) <x>))) (<num> (f <num>)) <y>)
        )
        
        ((READ ''REWRITE) (WRITE REWRITE))
    )
    
    // a proof for De Morgan's law: (A /\ B) <-> ~(~A \/ ~B)
    
    ( 1 : ([Assume] A /\ B)                                                          )
    (   2 : ([Assume] (~ A) \/ (~ B))                                                )
    (     3 : ([Assume] ~ A)                                                         )
    (       4 : ([Check] ([/\Elim1] (f 1)) A)                                        )
    (       5 : ([Check] ([~Elim] (f 3) (f 4)) False)                                )
    
    (     6 : ([Assume] ~ B)                                                         )
    (       7 : ([Check] ([/\Elim2] (f 1)) B)                                        )
    (       8 : ([Check] ([~Elim] (f 6) (f 7)) False)                                )
    
    (     9 : ([Check] ([\/Elim] (f 2) ((f 3) ... (f 5)) ((f 6) ... (f 8))) False)   )
    
    (  10 : ([Check] ([~Intro] (f 2) ... (f 9)) ~ ((~ A) \/ (~ B)))                  )
    
    (  F1 : ([Check] ([->Intro] (f 1) ... (f 10)) (A /\ B) -> (~ ((~ A) \/ (~ B)))) )
    
    (11 : ([Assume] ~ ((~ A) /\ (~ B)))                                              )
    (  12 : ([Assume] ~ A)                                                           )
    (    13 : ([Check] ([\/Intro1] (f 12)) ((~ A) \/ (~ B)))                         )
    (    14 : ([Check] ([~Elim] (f 11) (f 13)) False)                                )
    
    (  15 : ([Check] ([IP] (f12) .. (f14)) A)                                        )
    
    (    16 : ([Assume] ~ B)                                                         )
    (      17 : ([Check] ([\/Intro2] (f 16)) ((~ A) \/ (~ B)))                       )
    (      18 : ([Check] ([~Elim] (f 11) (f 17)) False)                              )
    
    (  19 : ([Check] ([IP] (f16) .. (f18)) B))

    (  20 : ([Check] ([/\intro] (f 15) (f 19)) (A /\ B))                             )
    
    (  20 : ([Check] ([~Intro] (f 2) ... (f 9)) ~ ((~ A) \/ (~ B)))                  )
    
    (  F2 : ([Check] ([->Intro] (f 11) ... (f 20)) (~ ((~ A) \/ (~ B))) -> (A /\ B)))
    
    ( 21: ([Check] ([<->Intro] (f F1) (f F2)) (A /\ B) <-> (~ ((~ A) \/ (~ B))))   )

    (qed (f 21))
)
</script>

<script id="exmpl-bool" type="text/plain">
/*
    Boolean operations
*/

(
    (
        REWRITE
        
        // AND
        (
            (READ  true && true)
            (WRITE true)
        ) (
            (READ  true && false)
            (WRITE false)
        ) (
            (READ  false && true)
            (WRITE false)
        ) (
            (READ  false && false)
            (WRITE false)
        )
        
        // OR
        (
            (READ  true || true)
            (WRITE true)
        ) (
            (READ  true || false)
            (WRITE true)
        ) (
            (READ  false || true)
            (WRITE true)
        ) (
            (READ  false || false)
            (WRITE false)
        )
        
        // NOT
        (
            (READ  ! true)
            (WRITE false)
        ) (
            (READ  ! false)
            (WRITE true)
        )
    )

    !((false && true) || false)
)
</script>

<script id="exmpl8" type="text/plain">
/*
    metarules
*/

(
    (
       REWRITE
       (
           (READ  var (VAR <x>))
           (WRITE VAR <x>      )
       ) (
           (READ  rule (VAR <x>) -> (VAR <y>)     )
           (WRITE REWRITE ((READ <x>) (WRITE <y>)))
       )
    )
    (
        (
            rule
            ((var a) + (var a)) -> (2 * a)
        )
        
        (N + N) + (N + N)
    )
)
</script>

<script id="exmpl-binadd" type="text/plain">
/*
    binary addition
*/

(
    (
        REWRITE
        
        // both numbers single digits
        (                    (READ +       0       0) (WRITE                   0))
        (                    (READ +       0       1) (WRITE                   1))
        (                    (READ +       1       0) (WRITE                   1))
        (                    (READ +       1       1) (WRITE                 1 0))
        
        // first number multiple digits, second number single digit
        (          (VAR <a>) (READ + (<a> 0)       0) (WRITE               <a> 0))
        (          (VAR <a>) (READ + (<a> 0)       1) (WRITE               <a> 1))
        (          (VAR <a>) (READ + (<a> 1)       0) (WRITE               <a> 1))
        (          (VAR <a>) (READ + (<a> 1)       1) (WRITE         (+ 1 <a>) 0))
        
        // first number single digit, second number multiple digits
        (          (VAR <b>) (READ +       0 (<b> 0)) (WRITE               <b> 0))
        (          (VAR <b>) (READ +       0 (<b> 1)) (WRITE               <b> 1))
        (          (VAR <b>) (READ +       1 (<b> 0)) (WRITE               <b> 1))
        (          (VAR <b>) (READ +       1 (<b> 1)) (WRITE         (+ 1 <b>) 0))
        
        // both numbers multiple digits
        ((VAR <a>) (VAR <b>) (READ + (<a> 0) (<b> 0)) (WRITE       (+ <a> <b>) 0))
        ((VAR <a>) (VAR <b>) (READ + (<a> 0) (<b> 1)) (WRITE       (+ <a> <b>) 1))
        ((VAR <a>) (VAR <b>) (READ + (<a> 1) (<b> 0)) (WRITE       (+ <a> <b>) 1))
        ((VAR <a>) (VAR <b>) (READ + (<a> 1) (<b> 1)) (WRITE (+ 1 (+ <a> <b>)) 0))
    )

    +
    (((1 1) 0) 0)
    (((0 1) 0) 1)
)
</script>

<script id="exmpl-eqpred" type="text/plain">
/*
    equality predicate
*/

(
    (
        REWRITE
        (          (VAR <x>) (READ <x> == <x>) (WRITE true))
        ((VAR <x>) (VAR <y>) (READ <x> == <y>) (WRITE false))
    )
  
    ((x + 1) == (x + 1))
    ((x + y) == (x - y))
    ((a b c d) == (a (b (c (d)))))
    ((a b c d) == ((((a) b) c) d))
)
</script>

<style type="text/css" media="screen">
    /*
    @font-face {
        font-family: 'Fira';
        src: url('FiraCode-Regular.ttf');
    }
    */
    
    html, body
    {
        overflow: hidden;
        height: 100%;
        width: 100%;
        margin-top: 0px;
        margin-left: 0px;
        background-color: white;
    }
    #ruleset1 {
        position:relative;
        width: 100%;
        height: 100%;
    }
    #input1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    #output1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    #nodes1 {
        position: relative;
        width: 100%;
        height: 100%;
        display: block;
    }
    
    #title  {color: #555555;}
    #foot   {color: #000000;}
    #all    {border-radius: 15px; border-spacing: 0px; border:0px solid #555555; color:#EEEEEE; background-color:#555555;}
    #top    {border-radius: 15px 15px 0px 0px; border-spacing: 0px; border:0px; color:#EEEEEE; background-color:#555555;}
    #bot    {border-radius: 0px 0px 15px 15px; border-spacing: 0px; border:0px; color:#EEEEEE; background-color:#555555;}
    #none   {border-radius: 0px 0px 0px 0px; color:#EEEEEE; background-color:#555555;}
    #in     {border:1px solid #555555; border-spacing: 0px; color:#EEEEEE; background-color:gray;}
    #dark   {border-spacing: 0px; border-left: 1px solid #4466DD; border-right: 1px solid #4466DD; border-bottom: 1px solid #4466DD; color:#DDEEFF; background-color:#334488;}

    a.exHover:visited, a.exHover:link {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    a.exHover:hover {cursor: pointer; background-color: #999999; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    a.exHover:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none; border-radius: 15px;}
    a {text-align: center;}

    .dropbtn:visited {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:link {cursor: pointer; background-color: #333333; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:hover {cursor: pointer; background-color: #999999; color:#EEEEEE; text-decoration:none; border-radius: 15px;}
    .dropbtn:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none; border-radius: 15px;}
    .dropbtn {
      text-align: left;
    }

    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      border-radius: 7px;
      display: none;
      position: absolute;
      background-color: #333333;
      min-width: 300px;
      overflow: auto;
      box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
      z-index: 65525;
    }

    .dropdown-content a {
      text-align: left;
      color: #EEEEEE;
      padding: 12px 12px;
      text-decoration: none;
      display: block;
    }

    .dropdown-content div {
      text-align: left;
      color: #AAAAAA;
      padding: 12px 12px;
      text-decoration: none;
      display: block;
    }

    .dropdown a:hover {background-color: #999999;}
    .dropdown a:active {cursor: pointer; background-color: #DDDDDD; color:#FFFFFF; text-decoration:none;}

    .show {display: block;}
</style>
</head>
<body style="font-family: Arial, Helvetica, sans-serif;">
<table width="100%" height="100%" align="center" valign="middle" cellspacing="0" cellpadding="0" border="10px" style="border: 10px solid white;">
<tbody>
<tr>
<td class="exRound" id="top" cellpadding="10" align="center" valign="middle" height="30">
<font size="5"><strong>rewrite playground</strong></font>
</td>
</tr>
<tr>
<td id="in">
    <table width="100%" cellspacing="10" cellpadding="0" height="100%" border="0">
        <tbody><tr>
        <td width="50%"">
            <table width="100%" cellspacing="0" cellpadding="0" height="100%" border="0">
            <tbody><tr>
             <td class="exRound" id="top" valign="middle" height="30">
                <font size="2">
                <b>
<div class="dropdown">
                  &nbsp; &nbsp; input: &nbsp;
                  <a id="mdd" onclick="myFunction()" href="javascript:void(null);" class="dropbtn">
                    &nbsp; examples &nbsp;
                  </a> &nbsp;
    <div id="myDropdown" class="dropdown-content">
        <!--div class="droplbl">descr</div-->
        <a href="javascript:populate('exmpl1');">&nbsp;&nbsp;&nbsp; hello world 1</a>
        <a href="javascript:populate('exmpl2');">&nbsp;&nbsp;&nbsp; hello world 2</a>
        <hr/>
        <a href="javascript:populate('exmpl3');">&nbsp;&nbsp;&nbsp; Venus likes milk</a>
        <a href="javascript:populate('exmpl4');">&nbsp;&nbsp;&nbsp; Pluto likes bones</a>
        <a href="javascript:populate('exmpl5');">&nbsp;&nbsp;&nbsp; Nikki likes cheese</a>
        <hr/>
        <a href="javascript:populate('exmpl-eqpred');">&nbsp;&nbsp;&nbsp; equality predicate</a>
        <a href="javascript:populate('exmpl-bool');">&nbsp;&nbsp;&nbsp; Boolean operations</a>
        <a href="javascript:populate('exmpl-binadd');">&nbsp;&nbsp;&nbsp; binary number addition</a>
        <a href="javascript:populate('exmpl-proof');">&nbsp;&nbsp;&nbsp; proof checking // under construction //</a>
    </div>
</div>
                </b>
                </font>
             </td>
            </tr>
            <tr height="100%">
             <!-- style="margin-top:-8px;"-->
             <td class="exRound" id="in" valign="top">
                <textarea id="input" spellcheck="false" wrap="off" style="outline: none; box-sizing: border-box; width: 100%; height:100%; resize: none; display: block; border-style: none; background-color: black; color: white; font: 8pt monospace; margin: 0; padding:5px;"></textarea>
                <script>
                    input1 = document.getElementById('input');
                </script>
             </td>
            </tr>
            <tr>
              <td class="exRound" id="bot" height="5" align="right">
               <font size="1">
                <label id="lblGrammarCaret">(1, 1)</label>&nbsp;&nbsp;&nbsp;
               </font>
              </td>
            </tr>
            </tbody></table>
        </td>
        <td width="50%" height="100%">
            <table width="100%" cellspacing="0" cellpadding="0" height="100%" border="0">
            <tbody><tr>
             <td class="exRound" id="top" valign="middle" height="30">
                <font size="2">
                <b>
                  &nbsp; &nbsp; output: &nbsp;
                  <a onclick="compile()" class="exHover" href="javascript:void(null);">
                    &nbsp; compile &nbsp;
                  </a> &nbsp;
                </b>
                </font>
             </td>
            </tr>
            <tr height="100%">
             <td class="exRound" id="in" style="border-radius: 0px 0px 15px 15px;">
              <textarea readonly wrap="off" spellcheck="false" id="output" style="outline: none; box-sizing: border-box; width: 100%; height:100%; resize: none; display: block; border-style: none; background-color: black; color: white; font: 8pt monospace; border-radius: 0px 0px 14px 14px; margin: 0; padding:5px;"></textarea>
                <script>
                    output1 = document.getElementById('output');
                </script>
             </td>
            </tr>
            </tbody></table>
        </td>
        </tr>
    </tbody></table>
</td>
</tr>
<tr>
 <td id="bot" valign="middle" height="30">
    <table width="100%" height="100%">
    <tr>
        <td align="left">
            <!--font size="2">
                &nbsp; &nbsp;
            </font-->
        </td>
        <td align="right">
            <font size="3">
              <b>
                <a class="exHover" href="https://github.com/contrast-zone/rewrite" target="new">
                &nbsp; visit me on GitHub &nbsp;
                </a>
                &nbsp; &nbsp;
              </b>
            </font>
        </td>
    </tr>
    </table>
 </td>
</tr>
</tbody>
</table>

<script>
    /* When the user clicks on the button, 
    toggle between hiding and showing the dropdown content */
    function myFunction() {
      document.getElementById("myDropdown").draggable = false;
      document.getElementById("myDropdown").ondragstart = function () {return false};
            
      document.getElementById("myDropdown").style.left = document.getElementById("mdd").offsetLeft + "px";
      document.getElementById("myDropdown").style.top = document.getElementById("mdd").offsetTop + document.getElementById("mdd").offsetHeight + 3 + "px";
      
      document.getElementById("myDropdown").classList.toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function(event) {
      if (!event.target.matches('.dropbtn') && !event.target.matches('.droplbl')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }
    
    function getCoords (text, offset) {
        var i, ch, row = 1, col = 1;
        if (text.length > 0)
            for (i = 0; i < offset; i += 1) {
                ch = text.charCodeAt(i);
                if (ch === 13 || ch === 10) {
                    if (ch === 13 && text.charCodeAt (i + 1) === 10)
                        i += 1;

                    row += 1;
                    col = 1;
                    
                } else
                  col += 1;
            }
        
        return {row: row, column: col};
    }

    function onkd () {
        var c = getCoords (input1.value, input1.selectionStart)
        document.getElementById("lblGrammarCaret").innerHTML = "(" + c.row + ", " + c.column + ")";
    }
    
    function populate (param) {
        input1.value = document.getElementById(param).innerHTML;
        output1.value = "";
        setTimeout(function() {
            input1.selectionStart = 0;
            input1.selectionEnd = 0;
            output1.selectionStart = 0;
            output1.selectionEnd = 0;
            onkd ();
            input1.focus();
        }, 0);
    }
    
    cr = String.fromCharCode(13);
    
    function stringify (node, indent) {
        var str = ""
        
        str += indent + "(\n";
        
        for (var i = 0; i < node.length; i++) {
            if (Array.isArray (node[i]))
                str += stringify (node[i], indent + "    ");
                
            else {
                var part
                if (node [i] === undefined)
                    part = "undefined";
                    
                else if (node [i] === null)
                    part = "null";
                    
                else
                    part = node[i].replaceAll("\n", "\\n");
                 
                 str += indent + "    " + part + "\n";
            }
        }
        
        str += indent + ")\n";
        
        return str;
    }
    
    function compile () {
        var p = rewrite (input1.value, 20000);
        if (p.err) {
            var c = getCoords (input1.value, p.pos)
            output.value = "Error: " + p.err + (p.pos>0? " at " + "(" + c.row + ", " + c.column + ")": "");
        } else {
            output1.value = stringify (p, "");
            //output1.value = JSON.stringify (p, null, 4);
        }
        output1.selectionStart = 0;
        output1.selectionEnd = 0;
    }

    input1.addEventListener("keyup", onkd, false);
    input1.addEventListener("input", onkd, false);
    input1.addEventListener("mousedown", onkd, false);
    input1.addEventListener("mouseup", onkd, false);

    populate ('exmpl1');
</script>

</body>
</html>

